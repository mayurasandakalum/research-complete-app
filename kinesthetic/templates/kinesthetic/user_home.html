{% extends "base.html" %}
{% block title %}Let's Quiz | Mixed Questions{% endblock %}

{% block content %}
<div class="container py-5">
    <h1 class="text-center mb-5">Kinesthetic ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫</h1>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h2 class="card-title mb-0">‡∂¥‡∑Ö‡∂∏‡∑î ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫</h2>
                    <a href="http://localhost:5000/student_dashboard" class="btn btn-outline-primary btn-sm">
                        <i class="fa fa-arrow-left"></i> ‡∂¥‡∑ä‚Äç‡∂ª‡∂∞‡∑è‡∂± ‡∂¥‡∑î‡∑Ä‡∂ª‡∑î‡∑Ä‡∂ß ‡∂Ü‡∂¥‡∑É‡∑î
                    </a>
                </div>
                <div class="card-body text-center">
                    <p class="card-text">‡∂∏‡∑ô‡∑Ñ‡∑í <u>‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏</u>, <u>‡∂Ö‡∂©‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏</u>, ‡∑É‡∑Ñ <u>‡∂ö‡∑è‡∂Ω‡∂∫</u> ‡∂∫‡∂± ‡∑Ä‡∑í‡∑Ç‡∂∫‡∂±‡∑ä ‡∑Ä‡∂Ω‡∑í‡∂±‡∑ä
                        ‡∂∏‡∑í‡∑Å‡∑ä‚Äç‡∂ª ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± 15 ‡∂ö‡∑ä ‡∂Ö‡∂©‡∂Ç‡∂ú‡∑î ‡∑Ä‡∑ö.</p>

                    {% if kinesthetic_profile and kinesthetic_profile.mixed_quiz_completed %}
                    <div class="completion-banner bg-success text-white p-3 rounded mb-4">
                        <h4>‡∂¥‡∑Ö‡∂∏‡∑î ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫ ‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´‡∂∫‡∑í! üéâ</h4>
                        <!-- <p class="lead mb-0">‡∂î‡∂∂‡∑ö ‡∂Ω‡∂ö‡∑î‡∂´‡∑î: {{ kinesthetic_profile.total_score }}</p> -->
                    </div>

                    <!-- Weakest Subject Analysis - Use passed weakest_subject directly -->
                    {% if weakest_subject %}
                    <div class="card mb-4">
                        {% if kinesthetic_profile and kinesthetic_profile.watched_videos and weakest_subject in
                        kinesthetic_profile.watched_videos %}
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫‡∂ß ‡∂Ö‡∂±‡∑î‡∑Ä ‡∂î‡∂∂ ‡∑Ä‡∑ê‡∂©‡∑í‡∂Ø‡∑î‡∂ª ‡∂Ö‡∂∞‡∑ä‚Äç‡∂∫‡∂∫‡∂±‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫ ‡∑Ä‡∑í‡∑Ç‡∂∫‡∂∫</h5>
                        </div>
                        {% else %}
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0">‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫‡∂ß ‡∂Ö‡∂±‡∑î‡∑Ä ‡∂î‡∂∂ ‡∑Ä‡∑ê‡∂©‡∑í‡∂Ø‡∑î‡∂ª ‡∂Ö‡∂∞‡∑ä‚Äç‡∂∫‡∂∫‡∂±‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫ ‡∑Ä‡∑í‡∑Ç‡∂∫‡∂∫</h5>
                        </div>
                        {% endif %}
                        <div class="card-body">
                            <h4 style="font-weight: bolder;">
                                {% if weakest_subject == 'addition' %}‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∂¥‡∑è‡∂©‡∂∏
                                {% elif weakest_subject == 'subtraction' %}‡∂Ö‡∂©‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∂¥‡∑è‡∂©‡∂∏
                                {% elif weakest_subject == 'time' %}‡∂ö‡∑è‡∂Ω‡∂∫ ‡∂¥‡∑è‡∂©‡∂∏
                                {% else %}{{ weakest_subject }}
                                {% endif %}
                            </h4>

                            {% if kinesthetic_profile.subject_performance and weakest_subject in
                            kinesthetic_profile.subject_performance %}
                            {% set perf = kinesthetic_profile.subject_performance[weakest_subject] %}
                            {% if perf.total > 0 %}
                            <p>‡∂¥‡∑Ö‡∂∏‡∑î ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫‡∑ö ‡∂Ω‡∂ö‡∑î‡∂´‡∑î: {{ "%.1f"|format((perf.correct / perf.total) * 100) }}%</p>
                            {% endif %}
                            {% endif %}

                            <p>‡∂Ø‡∑ê‡∂±‡∑ä, ‡∂î‡∂∂‡∂ß ‡∂Ö‡∂¥ ‡∂î‡∂∂‡∑ö <span>{% if weakest_subject == 'addition' %}‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                                    {% elif weakest_subject == 'subtraction' %}‡∂Ö‡∂©‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                                    {% elif weakest_subject == 'time' %}‡∂ö‡∑è‡∂Ω‡∂∫
                                    {% else %}{{ weakest_subject }}
                                    {% endif %}</span> ‡∂¥‡∑è‡∂©‡∂∏ ‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞ ‡∂Ø‡∑ê‡∂±‡∑î‡∂∏ ‡∑Ä‡∑ê‡∂©‡∑í ‡∂Ø‡∑í‡∂∫‡∑î‡∂´‡∑î ‡∂ö‡∂ª‡∂ú‡∑ê‡∂±‡∑ì‡∂∏‡∂ß ‡∂¥‡∑Ñ‡∂≠‡∑í‡∂±‡∑ä ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù‡∑Ä‡∂ö‡∑ä ‡∂±‡∑í‡∂ª‡∑ä‡∂Ø‡∑ö‡∑Å
                                ‡∂ö‡∂ª ‡∂á‡∂≠. ‡∂ë‡∂∫ ‡∂∂‡∂Ω‡∂±‡∑ä‡∂±.
                            </p>

                            <!-- Add link to video tutorial for weakest subject -->
                            {% if kinesthetic_profile and kinesthetic_profile.watched_videos and weakest_subject in
                            kinesthetic_profile.watched_videos %}
                            <button class="btn btn-success mt-2" disabled>
                                <i class="fa fa-check-circle"></i> ‡∂±‡∂ª‡∂π‡∑è ‡∂á‡∂≠
                            </button>
                            {% else %}
                            <a href="{{ url_for('kinesthetic.subject_help', subject=weakest_subject) }}"
                                class="btn btn-warning mt-2">
                                <i class="fa fa-play-circle"></i> ‡∑Ä‡∑í‡∂©‡∑í‡∂∫‡∑ù ‡∂¥‡∑è‡∂©‡∂∏ ‡∂∂‡∂Ω‡∂±‡∑ä‡∂±
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- <a href="{{ url_for('kinesthetic.leaderboard') }}" class="btn btn-primary">
                        ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂µ‡∂Ω ‡∂∂‡∂Ω‡∂±‡∑ä‡∂±
                    </a> -->
                    {% else %}
                    <div class="progress mb-3" style="height: 30px;">
                        {% set progress = (kinesthetic_profile.current_lesson_attempts or 0) / 15 * 100 if
                        kinesthetic_profile else 0 %}
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                            style="width: {{ progress }}%;" aria-valuenow="{{ progress }}" aria-valuemin="0"
                            aria-valuemax="100">
                            {% if kinesthetic_profile %}{{ kinesthetic_profile.current_lesson_attempts }}/15{% else
                            %}0/15{% endif %}
                        </div>
                    </div>
                    <p class="card-text">‡∂î‡∂∂ ‡∂Ø‡∑ê‡∂±‡∂ß ‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´ ‡∂ö‡∑Ö ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±:
                        {% if kinesthetic_profile %}
                        <strong>{{ kinesthetic_profile.current_lesson_attempts }}/15</strong>
                        {% else %}
                        <strong>0/15</strong>
                        {% endif %}
                    </p>
                    <a href="{{ url_for('kinesthetic.play') }}" class="btn btn-primary btn-lg">
                        <i class="fa fa-play-circle"></i> ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫ ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                    </a>
                    {% endif %}
                </div>
            </div>

            <!-- Weakest Subject Quiz Option -->
            {% if kinesthetic_profile and weakest_subject and kinesthetic_profile.watched_videos and weakest_subject in
            kinesthetic_profile.watched_videos %}
            <!-- Calculate performance metrics for weakest subject -->
            {% set attempts_query = namespace(mixed_correct=0, mixed_total=0, weakest_correct=0, weakest_total=0) %}

            <!-- Count attempts by quiz_type and calculate improvement -->
            {% if kinesthetic_profile.subject_performance and weakest_subject in kinesthetic_profile.subject_performance
            %}
            <div class="card mt-4">
                <div class="card-header bg-light">
                    <h2>‡∂Ø‡∑ô‡∑Ä‡∂± ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫</h2>
                </div>
                <div class="card-body text-center">
                    <h6> ‡∂Ø‡∑ê‡∂±‡∑ä ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂∏‡∑ö
                        {% if weakest_subject == 'addition' %}‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                        {% elif weakest_subject == 'subtraction' %}‡∂Ö‡∂©‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                        {% elif weakest_subject == 'time' %}‡∂ö‡∑è‡∂Ω‡∂∫
                        {% else %}{{ weakest_subject }}
                        {% endif %}
                        ‡∑Ä‡∑í‡∑Ç‡∂∫‡∑ö ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± 5 ‡∂ö‡∑í‡∂±‡∑ä ‡∑É‡∂∏‡∂±‡∑ä‡∑Ä‡∑í‡∂≠ ‡∂Ø‡∑ô‡∑Ä‡∂± ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫‡∂ß ‡∂∏‡∑î‡∑Ñ‡∑î‡∂´ ‡∂Ø‡∑ì ‡∂î‡∂∂‡∑ö ‡∂¥‡∑ä‚Äç‡∂ª‡∂ú‡∂≠‡∑í‡∂∫ ‡∂¥‡∑í‡∂ª‡∑í‡∂ö‡∑ä‡∑É‡∑è ‡∂∂‡∂Ω‡∂∏‡∑î.
                    </h6>

                    <!-- Show different sections based on whether they've taken the second quiz -->
                    {% set has_weakest_attempt = false %}
                    {% set comparison_data = None %}

                    <!-- Check for attempts with quiz_type='weakest_subject' -->
                    {% if kinesthetic_profile.id %}
                    {% if kinesthetic_profile.quiz_comparisons and weakest_subject in
                    kinesthetic_profile.quiz_comparisons %}
                    {% set has_weakest_attempt = true %}
                    {% set comparison_data = kinesthetic_profile.quiz_comparisons[weakest_subject] %}

                    <!-- Display progress comparison when both quizzes attempted -->
                    <div class="comparison-stats mt-3">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h5>‡∂¥‡∑Ö‡∂∏‡∑î ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫</h5>
                                        <h3>{{ "%.1f"|format(comparison_data.before.percentage) }}%</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div
                                    class="card {% if comparison_data.after.percentage > comparison_data.before.percentage %}bg-success text-white{% else %}bg-light{% endif %}">
                                    <div class="card-body text-center">
                                        <h5>‡∂Ø‡∑ô‡∑Ä‡∂± ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫</h5>
                                        <h3>{{ "%.1f"|format(comparison_data.after.percentage) }}%</h3>
                                        <!-- Improvement indicator -->
                                        {% set diff = comparison_data.after.percentage -
                                        comparison_data.before.percentage %}
                                        {% if diff > 0 %}
                                        <span class="badge badge-light">+{{ "%.1f"|format(diff) }}%</span>
                                        {% elif diff < 0 %} <span class="badge badge-danger">{{ "%.1f"|format(diff)
                                            }}%</span>
                                            {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% elif kinesthetic_profile.subject_performance and weakest_subject in
                    kinesthetic_profile.subject_performance %}
                    {% set has_weakest_attempt = true %}

                    <!-- Display progress comparison when both quizzes attempted (using legacy method) -->
                    <div class="comparison-stats mt-3">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h5>‡∂¥‡∑Ö‡∂∏‡∑î ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫</h5>
                                        <h3>{{ "%.1f"|format(weakest.percentage) }}%</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h5>‡∂Ø‡∑ô‡∑Ä‡∂± ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫</h5>
                                        <h3>{{ "%.1f"|format(weakest.percentage) }}%</h3>
                                        <!-- Progress arrows would be dynamically generated in reality -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% endif %}

                    <!-- Show the button only if they haven't completed the second quiz -->
                    {% if not has_weakest_attempt %}
                    <a href="{{ url_for('kinesthetic.weakest_subject_quiz') }}" class="btn btn-warning">
                        <i class="fa fa-graduation-cap"></i> ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫ ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                    </a>
                    {% else %}
                    <p class="mt-3 text-success"><i class="fa fa-check-circle"></i> ‡∂î‡∂∂ ‡∂Ø‡∑ô‡∑Ä‡∂± ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫ ‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´ ‡∂ö‡∂ª
                        ‡∂á‡∂≠
                    </p>
                    <a href="{{ url_for('kinesthetic.weakest_subject_quiz') }}" class="btn btn-outline-warning btn-sm">
                        <i class="fa fa-redo"></i> ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            {% endif %}

            <!-- Quiz Comparison Section -->
            {% if kinesthetic_profile and kinesthetic_profile.quiz_comparisons and weakest_subject and weakest_subject
            in kinesthetic_profile.quiz_comparisons %}
            {% set comparison_data = kinesthetic_profile.quiz_comparisons[weakest_subject] %}
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0"><i class="fa fa-chart-line"></i> ‡∂î‡∂∂‡∑ö ‡∂¥‡∑ä‚Äç‡∂ª‡∂ú‡∂≠‡∑í‡∂∫</h3>
                </div>
                <div class="card-body">
                    <h5 class="text-center mb-4">
                        {% if weakest_subject == 'addition' %}‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                        {% elif weakest_subject == 'subtraction' %}‡∂Ö‡∂©‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                        {% elif weakest_subject == 'time' %}‡∂ö‡∑è‡∂Ω‡∂∫
                        {% else %}{{ weakest_subject }}
                        {% endif %}
                        ‡∑Ä‡∑í‡∑Ç‡∂∫‡∑ö ‡∂¥‡∑ä‚Äç‡∂ª‡∂ú‡∂≠‡∑í‡∂∫
                    </h5>

                    <div class="row quiz-progress">
                        <div class="col-md-5 text-center">
                            <div class="p-3 border rounded">
                                <h4>‡∂¥‡∑Ö‡∂∏‡∑î ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫</h4>
                                <div class="display-4">{{ "%.1f"|format(comparison_data.before.percentage) }}%</div>
                                <p class="text-muted">‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± {{ comparison_data.before.correct }}/{{
                                    comparison_data.before.total }}</p>
                            </div>
                        </div>

                        <div class="col-md-2 d-flex align-items-center justify-content-center">
                            {% set diff = comparison_data.after.percentage - comparison_data.before.percentage %}
                            {% if diff > 0 %}
                            <div class="text-success">
                                <i class="fa fa-arrow-right fa-2x"></i>
                            </div>
                            {% elif diff < 0 %} <div class="text-danger">
                                <i class="fa fa-arrow-right fa-2x"></i>
                        </div>
                        {% else %}
                        <div class="text-muted">
                            <i class="fa fa-arrows-h fa-2x"></i>
                        </div>
                        {% endif %}
                    </div>

                    <div class="col-md-5 text-center">
                        <div
                            class="p-3 border rounded {% if diff > 0 %}bg-success text-white{% elif diff < 0 %}bg-danger text-white{% else %}{% endif %}">
                            <h4>‡∂Ø‡∑ô‡∑Ä‡∂± ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫</h4>
                            <div class="display-4">{{ "%.1f"|format(comparison_data.after.percentage) }}%</div>
                            <p
                                class="{% if diff > 0 %}text-white{% elif diff < 0 %}text-white{% else %}text-muted{% endif %}">
                                ‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± {{ comparison_data.after.correct }}/{{ comparison_data.after.total }}
                            </p>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-4">
                    {% if diff > 0 %}
                    <div class="alert alert-success">
                        <i class="fa fa-trophy"></i> ‡∂î‡∂∂ <strong>{{ "%.1f"|format(diff) }}%</strong> ‡∂ö‡∑í‡∂±‡∑ä ‡∑Ä‡∑ê‡∂©‡∑í‡∂Ø‡∑í‡∂∫‡∑î‡∂´‡∑î ‡∑Ä‡∑ì
                        ‡∂á‡∂≠!
                    </div>
                    {% elif diff < 0 %} <div class="alert alert-warning">
                        <i class="fa fa-exclamation-triangle"></i> ‡∂î‡∂∂‡∂ú‡∑ö ‡∂ö‡∑è‡∂ª‡∑ä‡∂∫ ‡∑É‡∑è‡∂∞‡∂±‡∂∫ <strong>{{ "%.1f"|format(diff|abs)
                            }}%</strong> ‡∂ö‡∑í‡∂±‡∑ä ‡∂Ö‡∂©‡∑î ‡∑Ä‡∑ì ‡∂á‡∂≠. ‡∂≠‡∑Ä ‡∂¥‡∑î‡∑Ñ‡∑î‡∂´‡∑î ‡∑Ä‡∂±‡∑ä‡∂±!
                </div>
                {% else %}
                <div class="alert alert-info">
                    <i class="fa fa-info-circle"></i> ‡∂î‡∂∂ ‡∂ë‡∂ö‡∂∏ ‡∂∏‡∂ß‡∑ä‡∂ß‡∂∏‡∑ö ‡∂¥‡∑Ä‡∂≠‡∑ì. ‡∂Ø‡∑í‡∂ú‡∂ß‡∂∏ ‡∂¥‡∑î‡∑Ñ‡∑î‡∂´‡∑î ‡∑Ä‡∂±‡∑ä‡∂±!
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <div class="card mt-4">
        <div class="card-header">
            <h3>‡∑Ä‡∑í‡∑Ç‡∂∫ ‡∂¥‡∑ä‚Äç‡∂ª‡∂ú‡∂≠‡∑í‡∂∫</h3>
        </div>
        <div class="card-body">
            <div class="subject-progress">
                {% if kinesthetic_profile and kinesthetic_profile.subject_counts %}
                {% for subject, count in kinesthetic_profile.subject_counts.items() %}
                <div class="subject-item mb-3">
                    <div class="d-flex justify-content-between">
                        <span>
                            {% if subject == 'addition' %}‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                            {% elif subject == 'subtraction' %}‡∂Ö‡∂©‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                            {% elif subject == 'time' %}‡∂ö‡∑è‡∂Ω‡∂∫
                            {% else %}{{ subject }}
                            {% endif %}

                            <!-- Show video watched badge -->
                            {% if kinesthetic_profile.watched_videos and subject in
                            kinesthetic_profile.watched_videos %}
                            <span class="badge badge-pill badge-success ml-2"
                                title="‡∂î‡∂∂ ‡∂∏‡∑ö ‡∑Ä‡∑í‡∑Ç‡∂∫‡∂∫‡∑ö ‡∂¥‡∑è‡∂©‡∂∏‡∑ä ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù‡∑Ä ‡∂±‡∂ª‡∂π‡∑è ‡∂á‡∂≠">
                                <i class="fa fa-check"></i> ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù‡∑Ä ‡∂±‡∂ª‡∂π‡∑è ‡∂á‡∂≠
                            </span>
                            {% else %}
                            <a href="{{ url_for('kinesthetic.subject_help', subject=subject) }}"
                                class="badge badge-pill badge-secondary ml-2" title="‡∂∏‡∑ö ‡∑Ä‡∑í‡∑Ç‡∂∫‡∂∫‡∑ö ‡∂¥‡∑è‡∂©‡∂∏‡∑ä ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù‡∑Ä ‡∂±‡∂ª‡∂π‡∂±‡∑ä‡∂±">
                                <i class="fa fa-play-circle"></i> ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù‡∑Ä ‡∂±‡∂ª‡∂π‡∂±‡∑ä‡∂±
                            </a>
                            {% endif %}
                        </span>
                        <span>{{ count }} ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±</span>
                    </div>
                    <div class="progress" style="height: 10px;">
                        <div class="progress-bar 
                                            {% if subject == 'addition' %}bg-success
                                            {% elif subject == 'subtraction' %}bg-warning
                                            {% elif subject == 'time' %}bg-info
                                            {% else %}bg-primary
                                            {% endif %}" style="width: {{ count / 15 * 100 }}%" role="progressbar">
                        </div>
                    </div>

                    {% if kinesthetic_profile.subject_performance and subject in
                    kinesthetic_profile.subject_performance %}
                    {% set perf = kinesthetic_profile.subject_performance[subject] %}
                    {% if perf.total > 0 %}
                    <div class="small text-muted mt-1">
                        {# Cache the calculation result to avoid repeated division operations #}
                        {% set percentage = (perf.correct / perf.total) * 100 %}
                        ‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í: {{ perf.correct }}/{{ perf.total }}
                        ({{ "%.1f"|format(percentage) }}%)
                    </div>
                    {% endif %}
                    {% endif %}
                </div>
                {% endfor %}
                {% else %}
                <p>‡∂î‡∂∂ ‡∂≠‡∑Ä‡∂∏ ‡∂ö‡∑í‡∑É‡∑í‡∂Ø‡∑î ‡∑Ä‡∑í‡∑Ç‡∂∫ ‡∂¥‡∂Æ‡∂∫‡∂ö ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± ‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´ ‡∂ö‡∂ª ‡∂±‡∑ê‡∂≠.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Display video watching status separately if any videos watched -->
    <!-- {% if kinesthetic_profile and kinesthetic_profile.watched_videos and
            kinesthetic_profile.watched_videos|length > 0 %}
            <div class="card mt-4">
                <div class="card-header bg-light">
                    <h3>‡∂±‡∂ª‡∂π‡∂± ‡∂Ω‡∂Ø ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù ‡∂¥‡∑è‡∂©‡∂∏‡∑ä</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for subject in ['addition', 'subtraction', 'time'] %}
                        <div class="col-md-4 mb-3">
                            <div
                                class="card h-100 {% if subject in kinesthetic_profile.watched_videos %}border-success{% else %}border-light{% endif %}">
                                <div class="card-body text-center">
                                    <h5>
                                        {% if subject == 'addition' %}‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                                        {% elif subject == 'subtraction' %}‡∂Ö‡∂©‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                                        {% elif subject == 'time' %}‡∂ö‡∑è‡∂Ω‡∂∫
                                        {% endif %}
                                    </h5>
                                    {% if subject in kinesthetic_profile.watched_videos %}
                                    <div class="text-success">
                                        <i class="fa fa-check-circle fa-2x"></i>
                                        <p class="mb-0">‡∂±‡∂ª‡∂π‡∑è ‡∂á‡∂≠</p>
                                    </div>
                                    {% else %}
                                    <div class="text-muted">
                                        <i class="fa fa-times-circle fa-2x"></i>
                                        <p class="mb-0">‡∂±‡∂ª‡∂π‡∑è ‡∂±‡∑ê‡∂≠</p>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="card-footer bg-transparent text-center">
                                    <a href="{{ url_for('kinesthetic.subject_help', subject=subject) }}"
                                        class="btn btn-sm {% if subject in kinesthetic_profile.watched_videos %}btn-outline-success{% else %}btn-primary{% endif %}">
                                        {% if subject in kinesthetic_profile.watched_videos %}
                                        <i class="fa fa-redo"></i> ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂±‡∂ª‡∂π‡∂±‡∑ä‡∂±
                                        {% else %}
                                        <i class="fa fa-play-circle"></i> ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù‡∑Ä ‡∂±‡∂ª‡∂π‡∂±‡∑ä‡∂±
                                        {% endif %}
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %} -->
</div>
</div>
</div>
{% endblock %}