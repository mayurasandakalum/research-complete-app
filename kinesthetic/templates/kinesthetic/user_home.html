{% extends "base.html" %}
{% block title %}Let's Quiz | Mixed Questions{% endblock %}

{% block content %}
<div class="container py-5">
    <h1 class="text-center mb-5">‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∂´‡∂∫</h1>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h2 class="card-title mb-0">‡∂∏‡∑í‡∑Å‡∑ä‚Äç‡∂ª ‡∂¥‡∑è‡∂©‡∂∏‡∑ä ‡∂∏‡∂ü‡∑í‡∂±‡∑ä ‡∂â‡∂ú‡∑ô‡∂±‡∂ú‡∂±‡∑ä‡∂±</h2>
                    <a href="http://localhost:5000/student_dashboard" class="btn btn-outline-primary btn-sm">
                        <i class="fa fa-arrow-left"></i> ‡∂¥‡∑ä‚Äç‡∂ª‡∂∞‡∑è‡∂± ‡∂¥‡∑î‡∑Ä‡∂ª‡∑î‡∑Ä‡∂ß ‡∂Ü‡∂¥‡∑É‡∑î
                    </a>
                </div>
                <div class="card-body text-center">
                    <p class="card-text">‡∑Ä‡∑í‡∑Ä‡∑í‡∂∞ ‡∑Ä‡∑í‡∑Ç‡∂∫ ‡∂ö‡∑ä‡∑Ç‡∑ö‡∂≠‡∑ä‚Äç‡∂ª ‡∑Ä‡∂Ω ‡∂∏‡∑í‡∑Å‡∑ä‚Äç‡∂ª ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± 15 (‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏, ‡∂Ö‡∂©‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∑É‡∑Ñ ‡∂ö‡∑è‡∂Ω‡∂∫)</p>

                    {% if kinesthetic_profile and kinesthetic_profile.mixed_quiz_completed %}
                    <div class="completion-banner bg-success text-white p-3 rounded mb-4">
                        <h4>‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´‡∂∫‡∑í! üéâ</h4>
                        <p class="lead mb-0">‡∂î‡∂∂‡∑ö ‡∂Ω‡∂ö‡∑î‡∂´‡∑î: {{ kinesthetic_profile.total_score }}</p>
                    </div>

                    <!-- Weakest Subject Analysis -->
                    {% if kinesthetic_profile.subject_performance %}
                    {% set weakest = kinesthetic_profile.get_weakest_subject() %}
                    {% if weakest.subject %}
                    <div class="card mb-4">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0">‡∑Ä‡∑ê‡∂©‡∑í‡∂Ø‡∑î‡∂ª ‡∂Ö‡∂∞‡∑ä‚Äç‡∂∫‡∂∫‡∂±‡∂∫ ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫ ‡∑Ä‡∑í‡∑Ç‡∂∫‡∂∫</h5>
                        </div>
                        <div class="card-body">
                            <h4>
                                {% if weakest.subject == 'addition' %}‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                                {% elif weakest.subject == 'subtraction' %}‡∂Ö‡∂©‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                                {% elif weakest.subject == 'time' %}‡∂ö‡∑è‡∂Ω‡∂∫
                                {% else %}{{ weakest.subject }}
                                {% endif %}
                            </h4>
                            <p>‡∂î‡∂∂‡∂ú‡∑ö ‡∂ö‡∑è‡∂ª‡∑ä‡∂∫ ‡∑É‡∑è‡∂∞‡∂±‡∂∫: {{ "%.1f"|format(weakest.percentage) }}%</p>

                            <!-- Add link to video tutorial for weakest subject -->
                            <a href="{{ url_for('kinesthetic.subject_help', subject=weakest.subject) }}"
                                class="btn btn-warning mt-2">
                                <i class="fa fa-play-circle"></i> ‡∑Ä‡∑í‡∂©‡∑í‡∂∫‡∑ù ‡∂¥‡∑è‡∂©‡∂∏ ‡∂∂‡∂Ω‡∂±‡∑ä‡∂±
                            </a>
                        </div>
                    </div>
                    {% endif %}
                    {% endif %}

                    <a href="{{ url_for('kinesthetic.leaderboard') }}" class="btn btn-primary">
                        ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂µ‡∂Ω ‡∂∂‡∂Ω‡∂±‡∑ä‡∂±
                    </a>
                    {% else %}
                    <div class="progress mb-3" style="height: 30px;">
                        {% set progress = (kinesthetic_profile.current_lesson_attempts or 0) / 15 * 100 if
                        kinesthetic_profile else 0 %}
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                            style="width: {{ progress }}%;" aria-valuenow="{{ progress }}" aria-valuemin="0"
                            aria-valuemax="100">
                            {% if kinesthetic_profile %}{{ kinesthetic_profile.current_lesson_attempts }}/15{% else
                            %}0/15{% endif %}
                        </div>
                    </div>
                    <p class="card-text">‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´ ‡∂ö‡∑Ö ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±:
                        {% if kinesthetic_profile %}
                        <strong>{{ kinesthetic_profile.current_lesson_attempts }}/15</strong>
                        {% else %}
                        <strong>0/15</strong>
                        {% endif %}
                    </p>
                    <a href="{{ url_for('kinesthetic.play') }}" class="btn btn-primary btn-lg">
                        <i class="fa fa-play-circle"></i> ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∂´‡∂∫ ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                    </a>
                    {% endif %}
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h3>‡∑Ä‡∑í‡∑Ç‡∂∫ ‡∂¥‡∑ä‚Äç‡∂ª‡∂ú‡∂≠‡∑í‡∂∫</h3>
                </div>
                <div class="card-body">
                    <div class="subject-progress">
                        {% if kinesthetic_profile and kinesthetic_profile.subject_counts %}
                        {% for subject, count in kinesthetic_profile.subject_counts.items() %}
                        <div class="subject-item mb-3">
                            <div class="d-flex justify-content-between">
                                <span>
                                    {% if subject == 'addition' %}‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                                    {% elif subject == 'subtraction' %}‡∂Ö‡∂©‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                                    {% elif subject == 'time' %}‡∂ö‡∑è‡∂Ω‡∂∫
                                    {% else %}{{ subject }}
                                    {% endif %}

                                    <!-- Show video watched badge -->
                                    {% if kinesthetic_profile.watched_videos and subject in
                                    kinesthetic_profile.watched_videos %}
                                    <span class="badge badge-pill badge-success ml-2"
                                        title="‡∂î‡∂∂ ‡∂∏‡∑ö ‡∑Ä‡∑í‡∑Ç‡∂∫‡∂∫‡∑ö ‡∂¥‡∑è‡∂©‡∂∏‡∑ä ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù‡∑Ä ‡∂±‡∂ª‡∂π‡∑è ‡∂á‡∂≠">
                                        <i class="fa fa-check"></i> ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù‡∑Ä ‡∂±‡∂ª‡∂π‡∑è ‡∂á‡∂≠
                                    </span>
                                    {% else %}
                                    <a href="{{ url_for('kinesthetic.subject_help', subject=subject) }}"
                                        class="badge badge-pill badge-secondary ml-2"
                                        title="‡∂∏‡∑ö ‡∑Ä‡∑í‡∑Ç‡∂∫‡∂∫‡∑ö ‡∂¥‡∑è‡∂©‡∂∏‡∑ä ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù‡∑Ä ‡∂±‡∂ª‡∂π‡∂±‡∑ä‡∂±">
                                        <i class="fa fa-play-circle"></i> ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù‡∑Ä ‡∂±‡∂ª‡∂π‡∂±‡∑ä‡∂±
                                    </a>
                                    {% endif %}
                                </span>
                                <span>{{ count }} ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±</span>
                            </div>
                            <div class="progress" style="height: 10px;">
                                <div class="progress-bar 
                                            {% if subject == 'addition' %}bg-success
                                            {% elif subject == 'subtraction' %}bg-warning
                                            {% elif subject == 'time' %}bg-info
                                            {% else %}bg-primary
                                            {% endif %}" style="width: {{ count / 15 * 100 }}%" role="progressbar">
                                </div>
                            </div>

                            {% if kinesthetic_profile.subject_performance and subject in
                            kinesthetic_profile.subject_performance %}
                            {% set perf = kinesthetic_profile.subject_performance[subject] %}
                            {% if perf.total > 0 %}
                            <div class="small text-muted mt-1">
                                ‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í: {{ perf.correct }}/{{ perf.total }}
                                ({{ "%.1f"|format((perf.correct / perf.total) * 100) }}%)
                            </div>
                            {% endif %}
                            {% endif %}
                        </div>
                        {% endfor %}
                        {% else %}
                        <p>‡∂î‡∂∂ ‡∂≠‡∑Ä‡∂∏ ‡∂ö‡∑í‡∑É‡∑í‡∂Ø‡∑î ‡∑Ä‡∑í‡∑Ç‡∂∫ ‡∂¥‡∂Æ‡∂∫‡∂ö ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± ‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´ ‡∂ö‡∂ª ‡∂±‡∑ê‡∂≠.</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Display video watching status separately if any videos watched -->
            {% if kinesthetic_profile and kinesthetic_profile.watched_videos and
            kinesthetic_profile.watched_videos|length > 0 %}
            <div class="card mt-4">
                <div class="card-header bg-light">
                    <h3>‡∂±‡∂ª‡∂π‡∂± ‡∂Ω‡∂Ø ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù ‡∂¥‡∑è‡∂©‡∂∏‡∑ä</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for subject in ['addition', 'subtraction', 'time'] %}
                        <div class="col-md-4 mb-3">
                            <div
                                class="card h-100 {% if subject in kinesthetic_profile.watched_videos %}border-success{% else %}border-light{% endif %}">
                                <div class="card-body text-center">
                                    <h5>
                                        {% if subject == 'addition' %}‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                                        {% elif subject == 'subtraction' %}‡∂Ö‡∂©‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                                        {% elif subject == 'time' %}‡∂ö‡∑è‡∂Ω‡∂∫
                                        {% endif %}
                                    </h5>
                                    {% if subject in kinesthetic_profile.watched_videos %}
                                    <div class="text-success">
                                        <i class="fa fa-check-circle fa-2x"></i>
                                        <p class="mb-0">‡∂±‡∂ª‡∂π‡∑è ‡∂á‡∂≠</p>
                                    </div>
                                    {% else %}
                                    <div class="text-muted">
                                        <i class="fa fa-times-circle fa-2x"></i>
                                        <p class="mb-0">‡∂±‡∂ª‡∂π‡∑è ‡∂±‡∑ê‡∂≠</p>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="card-footer bg-transparent text-center">
                                    <a href="{{ url_for('kinesthetic.subject_help', subject=subject) }}"
                                        class="btn btn-sm {% if subject in kinesthetic_profile.watched_videos %}btn-outline-success{% else %}btn-primary{% endif %}">
                                        {% if subject in kinesthetic_profile.watched_videos %}
                                        <i class="fa fa-redo"></i> ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂±‡∂ª‡∂π‡∂±‡∑ä‡∂±
                                        {% else %}
                                        <i class="fa fa-play-circle"></i> ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù‡∑Ä ‡∂±‡∂ª‡∂π‡∂±‡∑ä‡∂±
                                        {% endif %}
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}